@using RealEstate_Dapper_UI.Dtos.EstateAgentDtos
@model (List<ResultEstateAgentChartDto> chart1, List<ResultEstateAgentProductChartDto> chart2)
<body>
    <div class="container-fluid pt-4 px-4">
        <div class="row g-4">
            <div class="col-sm-12 col-xl-6">
                <div class="bg-light text-center rounded p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <h6 class="mb-0">En Fazla İlana Sahip Şehirler</h6>
                    </div>
                    <canvas id="worldwide-sales"></canvas>
                </div>
            </div>
            <div class="col-sm-12 col-xl-6">
                <div class="bg-light text-center rounded p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <h6 class="mb-0">Yıllara Göre İlanlarınız</h6>
                    </div>
                    <canvas id="salse-revenue"></canvas>
                </div>
            </div>
        </div>
    </div>


    <script>
        const cityLabels = @Html.Raw(Json.Serialize(Model.Item1?.Select(x => x.City).ToList() ?? new List<string>()));
        const ilanSayilariData = @Html.Raw(Json.Serialize(Model.Item1?.Select(x => x.ProductCount).ToList() ?? new List<int>()));

        const productData = @Html.Raw(Json.Serialize(Model.Item2?.Select(x => x.ProductCount).ToList() ?? new List<int>()));
        const yearData = @Html.Raw(Json.Serialize(Model.Item2?.Select(x => x.Year).ToList() ?? new List<int>()));

        // --- GRAFİK 1 ---
        const ctx1 = document.getElementById('worldwide-sales').getContext('2d');
        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: cityLabels,
                datasets: [{
                    label: "İlan Sayısı",
                    data: ilanSayilariData,
                    backgroundColor: "rgba(0, 156, 255, .7)",
                    hoverBackgroundColor: "rgba(0, 156, 255, 1)",
                    borderRadius: 8,
                    barPercentage: 0.6
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.raw} Aktif İlan`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { drawBorder: false, color: '#ded9d9' },
                        title: { display: true, text: 'İlan Adedi' }
                    },
                    x: { grid: { display: false } }
                }
            }
        });

        // --- GRAFİK 2 ---
        const ctx2 = document.getElementById('salse-revenue').getContext('2d');
        new Chart(ctx2, {
            type: 'line',
            data: {
                labels: yearData,
                datasets: [{
                    data: productData,
                    backgroundColor: "rgba(0, 156, 255, .2)",
                    borderColor: "rgba(0, 156, 255, 1)",
                    fill: false,
                    tension: 0.4,
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false, position: 'bottom' }
                },
                scales: {
                    y: {
                        ticks: {
                            stepSize: 1,
                            precision: 0  
                        },
                        title: { display: true, text: 'İlan Adedi' },
                        grid: { drawBorder: false, color: '#ded9d9' }
                    },
                    x: { grid: { display: false } }
                }
            }
        });
    </script>
</body>